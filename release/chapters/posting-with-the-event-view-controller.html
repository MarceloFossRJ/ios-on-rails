<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="thoughtbot" />
  <meta name="author" content="Jessie Young" />
  <meta name="author" content="Diana Zmuda" />
  <title>iOS on Rails (Beta): Posting with the Event View Controller</title>
  <style type="text/css"><![CDATA[code{white-space: pre;}]]></style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="data:text/css,%2A%20%7B%0A%20%20%2Dmoz%2Dbox%2Dsizing%3A%20border%2Dbox%3B%0A%20%20%2Dwebkit%2Dbox%2Dsizing%3A%20border%2Dbox%3B%0A%20%20box%2Dsizing%3A%20border%2Dbox%3B%20%7D%0A%0Abody%20%7B%0A%20%20font%2Dsize%3A%201em%3B%0A%20%20height%3A%20100%25%3B%0A%20%20margin%3A%200%20auto%3B%0A%20%20max%2Dwidth%3A%2054em%3B%0A%20%20padding%3A%200%201em%204%2E5em%3B%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20600px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20padding%3A%200%204em%204%2E5em%3B%20%7D%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20700px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20font%2Dsize%3A%201%2E125em%3B%20%7D%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20800px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20padding%3A%200%206em%204%2E5em%3B%20%7D%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20880px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20padding%3A%200%208em%204%2E5em%3B%20%7D%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20940px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20padding%3A%200%2010em%204%2E5em%3B%20%7D%20%7D%0A%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%201800px%29%20%7B%0A%20%20%20%20body%20%7B%0A%20%20%20%20%20%20font%2Dsize%3A%201%2E375em%3B%20%7D%20%7D%0A%0Anav%20%7B%0A%20%20border%2Dbottom%3A%201px%20dashed%20%23dddddd%3B%0A%20%20border%2Dtop%3A%201px%20dashed%20%23dddddd%3B%0A%20%20padding%3A%201%2E5em%200%3B%0A%20%20margin%3A%201%2E5em%200%3B%20%7D%0A%20%20nav%20%3E%20ul%20%3E%20li%20%3E%20a%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%20%7D%0A%0Aheader%20%7B%0A%20%20padding%3A%204%2E5em%200%3B%20%7D%0A%0Abody%20%7B%0A%20%20%2Dwebkit%2Dfont%2Dsmoothing%3A%20antialiased%3B%0A%20%20color%3A%20%23444444%3B%0A%20%20font%2Dfamily%3A%20%22proxima%2Dnova%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20line%2Dheight%3A%201%2E5em%3B%20%7D%0A%0Ah1%2C%20h2%2C%20h3%2C%20h4%2C%20h5%2C%20h6%20%7B%0A%20%20color%3A%20%23222222%3B%0A%20%20font%2Dfamily%3A%20%22proxima%2Dnova%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20line%2Dheight%3A%201%2E25em%3B%0A%20%20margin%3A%201%2E5em%200%200%2E375em%3B%0A%20%20text%2Drendering%3A%20optimizeLegibility%3B%20%7D%0A%20%20h1%20%3E%20a%2C%20h2%20%3E%20a%2C%20h3%20%3E%20a%2C%20h4%20%3E%20a%2C%20h5%20%3E%20a%2C%20h6%20%3E%20a%20%7B%0A%20%20%20%20color%3A%20%23222222%3B%20%7D%0A%0Ah1%20%7B%0A%20%20margin%3A%203em%200%200%2E375em%3B%0A%20%20font%2Dsize%3A%201%2E75em%3B%20%7D%0A%20%20h1%20%3E%20a%20%7B%0A%20%20%20%20color%3A%20%23c32f34%3B%20%7D%0A%20%20%20%20h1%20%3E%20a%3Ahover%2C%20h1%20%3E%20a%3Afocus%20%7B%0A%20%20%20%20%20%20color%3A%20%23222222%3B%20%7D%0A%20%20h1%2Etitle%20%7B%0A%20%20%20%20font%2Dsize%3A%203em%3B%0A%20%20%20%20font%2Dweight%3A%20900%3B%0A%20%20%20%20line%2Dheight%3A%201%3B%0A%20%20%20%20margin%3A%200%200%20%2E125em%3B%20%7D%0A%20%20%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20600px%29%20%7B%0A%20%20%20%20%20%20h1%2Etitle%20%7B%0A%20%20%20%20%20%20%20%20font%2Dsize%3A%204em%3B%20%7D%20%7D%0A%0Ah2%20%7B%0A%20%20font%2Dsize%3A%201em%3B%0A%20%20letter%2Dspacing%3A%201px%3B%0A%20%20text%2Dtransform%3A%20uppercase%3B%20%7D%0A%20%20h2%2Eauthor%20%7B%0A%20%20%20%20color%3A%20%23999999%3B%0A%20%20%20%20float%3A%20left%3B%0A%20%20%20%20font%2Dsize%3A%201em%3B%0A%20%20%20%20font%2Dweight%3A%20200%3B%0A%20%20%20%20margin%3A%200%3B%0A%20%20%20%20text%2Dtransform%3A%20none%3B%20%7D%0A%20%20%20%20%40media%20screen%20and%20%28min%2Dwidth%3A%20600px%29%20%7B%0A%20%20%20%20%20%20h2%2Eauthor%20%7B%0A%20%20%20%20%20%20%20%20font%2Dsize%3A%201%2E25em%3B%20%7D%20%7D%0A%20%20%20%20h2%2Eauthor%3Anot%28%3Alast%2Dchild%29%20%7B%0A%20%20%20%20%20%20margin%2Dright%3A%201em%3B%20%7D%0A%0Ah3%20%7B%0A%20%20font%2Dsize%3A%201em%3B%20%7D%0A%0Ah4%20%7B%0A%20%20font%2Dsize%3A%201%2E5em%3B%20%7D%0A%0Ah5%20%7B%0A%20%20font%2Dsize%3A%201%2E25em%3B%20%7D%0A%0Ah6%20%7B%0A%20%20font%2Dsize%3A%201em%3B%20%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%200%200%2E75em%3B%20%7D%0A%0Aa%20%7B%0A%20%20%2Dmoz%2Dtransition%3A%20all%200%2E15s%20ease%2Dout%200%3B%0A%20%20%2Dwebkit%2Dtransition%3A%20all%200%2E15s%20ease%2Dout%200%3B%0A%20%20color%3A%20%23477dca%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%20%20transition%3A%20all%200%2E15s%20ease%2Dout%200%3B%20%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%232c5999%3B%20%7D%0A%20%20a%3Aactive%2C%20a%3Afocus%20%7B%0A%20%20%20%20color%3A%20%232c5999%3B%0A%20%20%20%20outline%3A%20none%3B%20%7D%0A%0Ahr%20%7B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23dddddd%3B%0A%20%20margin%3A%201%2E5em%200%3B%20%7D%0A%0Aimg%20%7B%0A%20%20margin%3A%200%3B%0A%20%20max%2Dwidth%3A%20100%25%3B%20%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20inconsolata%2C%20%22Bitstream%20Vera%20Sans%20Mono%22%2C%20Consolas%2C%20Courier%2C%20monospace%3B%0A%20%20font%2Dsize%3A%20%2E875em%3B%0A%20%20white%2Dspace%3A%20pre%3B%0A%20%20word%2Dwrap%3A%20break%2Dword%3B%20%7D%0A%0Apre%20%7B%0A%20%20background%3A%20%23f7f7f7%3B%0A%20%20border%3A%201px%20solid%20%23dddddd%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%20%20overflow%2Dx%3A%20scroll%3B%0A%20%20padding%3A%20%2E5rem%201rem%3B%0A%20%20white%2Dspace%3A%20pre%3B%0A%20%20word%2Dwrap%3A%20normal%3B%20%7D%0A%20%20pre%20code%20%7B%0A%20%20%20%20word%2Dwrap%3A%20normal%3B%20%7D%0A%0Ablockquote%20%7B%0A%20%20border%2Dleft%3A%202px%20solid%20%23dddddd%3B%0A%20%20color%3A%20%236a6a6a%3B%0A%20%20margin%3A%201%2E5em%200%3B%0A%20%20padding%2Dleft%3A%200%2E75em%3B%20%7D%0A" rel="stylesheet" />
  <script type="text/javascript"><![CDATA[
    (function() {
      var config = {
        kitId: 'bgd6ksj',
        scriptTimeout: 3000
      };
      var h=document.getElementsByTagName("html")[0];h.className+=" wf-loading";var t=setTimeout(function(){h.className=h.className.replace(/(\s|^)wf-loading(\s|$)/g," ");h.className+=" wf-inactive"},config.scriptTimeout);var tk=document.createElement("script"),d=false;tk.src='//use.typekit.net/'+config.kitId+'.js';tk.type="text/javascript";tk.async="true";tk.onload=tk.onreadystatechange=function(){var a=this.readyState;if(d||a&&a!="complete"&&a!="loaded")return;d=true;clearTimeout(t);try{Typekit.load(config)}catch(b){}};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(tk,s)
    })();
  ]]></script>
</head>
<body><section id="posting-with-the-event-view-controller" class="level1">
<h1>Posting with the Event View Controller</h1>
<section id="creating-a-custom-cell" class="level3">
<h3>Creating a Custom Cell</h3>
<p>We just implemented posting a pre-made event to our API, but what we really want is to post an event based on user input. So, we need to create some custom cells for our HUMEventViewController.</p>
<p>Create a new subclass of UITableViewCell called HUMTextFieldCell. Define a property called <code>textField</code> in the header file. We'll also want to define a static string that we can use as this cell's reuse identifier.</p>
<pre><code>// HUMTextFieldCell.h

static NSString *kTextFieldCellID = @"kTextFieldCellID";

@interface HUMTextFieldCell : UITableViewCell

@property (strong, nonatomic) UITextField *textField;

@end</code></pre>
<p>Now we'll want to initialize that <code>textView</code> and add it as a subview of our cell in a custom init method. We'll also set the <code>selectionStyle</code> to <code>UITableViewCellSelectionStyleNone</code> since we don't want any visual response when the user selects the cell.</p>
<pre><code>// HUMTextFieldCell.m

- (id)initWithStyle:(UITableViewCellStyle)style
    reuseIdentifier:(NSString *)reuseIdentifier
{
    self = [super initWithStyle:UITableViewCellStyleDefault
                reuseIdentifier:reuseIdentifier];
    if (!self) {
        return nil;
    }

    _textField = [[UITextField alloc] initWithFrame:self.contentView.bounds];
    _textField.delegate = self;
    [self.contentView addSubview:_textField];
    
    self.selectionStyle = UITableViewCellSelectionStyleNone;

    return self;
}</code></pre>
<p>We want the user to be able to return out of the text field, so implement the delegate method <code>-textFieldShouldReturn:</code>.</p>
<pre><code>// HUMTextFieldCell.m

- (BOOL)textFieldShouldReturn:(UITextField *)textField
{
    [textField resignFirstResponder];
    return YES;
}</code></pre>
<p>This text field will receive and display text for the name and address properties, but will receive a date object and display text for the start and end dates.</p>
<p>So, lets create a method for setting a date on the cell. We'll use this method on the start and end date cells. Declare it as <code>- (void)setDate:(NSDate *)date</code> in HUMTextFieldCell.h and definite it as follows:</p>
<pre><code>// HUMTextFieldCell.m

- (void)setDate:(NSDate *)date
{
    UIDatePicker *picker = [[UIDatePicker alloc] init];
    [picker addTarget:self
               action:@selector(changeTextField:)
     forControlEvents:UIControlEventValueChanged];
    [picker setDate:date];

    self.textField.inputView = picker;
}</code></pre>
<p>We're using a <code>UIDatePicker</code> as the <code>textField</code>'s input view to let the user pick a new date after we set the initial date on the picker. When they pick a new date, the method <code>-changeTextField:</code> will fire, as we defined with <code>-addTarget:action:forControlEvents:</code>. Don't forget to <code>#import "NSDateFormatter+HUMDefaultDateFormatter.h"</code>.</p>
<pre><code>// HUMTextFieldCell.m

- (void)changeTextField:(UIDatePicker *)picker
{
    self.textField.text = [[NSDateFormatter hum_RFC3339DateFormatter]
                           stringFromDate:picker.date];
}</code></pre>
</section>
<section id="using-a-custom-cell" class="level3">
<h3>Using a Custom Cell</h3>
<p>Back in the <code>HUMEventViewController.m</code>, we can use this new custom cell by adding <code>#import "HUMTextFieldCell.h"</code> to the top of the file and then registering our new custom cell class with the <code>tableView</code>. We'll use the constant string <code>kTextFieldCellID</code> that we just defined.</p>
<pre><code>// HUMEventViewController.m

- (instancetype)initWithEvent:(HUMEvent *)event editable:(BOOL)editable;
{
    self = [super initWithStyle:UITableViewStylePlain];
    if (!self) {
        return nil;
    }
    
    [self.tableView registerClass:[HUMTextFieldCell class]
        forCellReuseIdentifier:kTextFieldCellID];
    ...
}</code></pre>
<p>Then, define four new properties in our hidden interface.</p>
<pre><code>// HUMEventViewController.m

@property (strong, nonatomic) HUMTextFieldCell *nameCell;
@property (strong, nonatomic) HUMTextFieldCell *addressCell;
@property (strong, nonatomic) HUMTextFieldCell *startCell;
@property (strong, nonatomic) HUMTextFieldCell *endCell;</code></pre>
<p>Now we can use these properties and the <code>kTextFieldCellID</code> identifier in the <code>-tableView:cellForRowAtIndexPath:</code> method. After we dequeue a new cell with our identifier, we set whether the user can edit the <code>textField</code>. We also reset the input view, in case it was previously a UIDatePicker but should now use the keyboard for input.</p>
<pre><code>// HUMEventViewController.m

- (UITableViewCell *)tableView:(UITableView *)tableView 
         cellForRowAtIndexPath:(NSIndexPath *)indexPath 
{
    HUMTextFieldCell *cell = [tableView
                              dequeueReusableCellWithIdentifier:kTextFieldCellID
                              forIndexPath:indexPath];                                                                
    cell.textField.userInteractionEnabled = self.editable;
    cell.textField.inputView = nil;
    
    // Switch statement to format cell for index path
    
    return cell;
}</code></pre>
<p>Now, on to the switch statement that will format our cells.</p>
<pre><code>// HUMEventViewController.m

switch (indexPath.row) {
    case HUMEventCellName:
        self.nameCell = cell;
        cell.textField.placeholder = NSLocalizedString(@"Name", nil);
        cell.textField.text = self.event.name;
        break;
    case HUMEventCellAddress:
        self.addressCell = cell;
        cell.textField.placeholder = NSLocalizedString(@"Address", nil);
        cell.textField.text = self.event.address;
        break;
    case HUMEventCellStart:
        self.startCell = cell;
        cell.textField.placeholder = NSLocalizedString(@"Start Date", nil);
        [cell setDate:self.event.startDate ?: [NSDate date]];
        break;
    case HUMEventCellEnd:
        self.endCell = cell;
        cell.textField.placeholder = NSLocalizedString(@"End Date", nil);
        [cell setDate:self.event.endDate ?: [NSDate date]];
        break;
    case HUMEventCellSubmit:
        cell.textField.text = NSLocalizedString(@"Submit", nil);
        cell.textField.userInteractionEnabled = NO;
        break;
    default:
        break;
}</code></pre>
<p>Now that all of our cell properties are set, we can run the app and see what it looks like.</p>
</section>
<section id="reflecting-cell-input" class="level3">
<h3>Reflecting Cell Input</h3>
<p>We have our new cell properties, but we are still relying on the fake event data we set in the <code>HUMMapViewController.m</code>.</p>
<p>To make a POST to events with user input, we need to:</p>
<ol type="1">
<li>Remove the fake data we placed in <code>HUMMapViewController.m</code>.</li>
</ol>
<p>Go back to the <code>-addButtonPressed</code> method in <code>HUMMapViewController.m</code> and remove the assignment of the properties <code>event.name</code> <code>event.address</code> <code>event.startDate</code> <code>event.endDate</code>. Do not remove the assignment of <code>event.coordinate</code>, since we still need that to be set by the HUMMapViewController.</p>
<ol start="2" type="1">
<li><p>Assign our user inputted properties to the event on <code>HUMEventViewController</code>.</p>
<p>// HUMEventViewController.m</p>
<ul>
<li><p>(void)tableView:(UITableView <em>)tableView didSelectRowAtIndexPath:(NSIndexPath </em>)indexPath { if (indexPath.row != HUMEventCellSubmit) return;</p>
<p>self.event.name = self.nameCell.textField.text; self.event.address = self.addressCell.textField.text; self.event.startDate = [(UIDatePicker *) self.startCell.textField.inputView date]; self.event.endDate = [(UIDatePicker *) self.endCell.textField.inputView date]; ... }</p></li>
</ul></li>
</ol>
<p>Now, go ahead and run the app. The event object that gets posted by the <code>HUMEventViewController</code> now reflects user input.</p>
</section>
</section></body>
</html>
